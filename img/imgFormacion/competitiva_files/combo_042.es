YUI.add("hermes-template-photo-list-action-bar",(function(n,t){var l=n.Template.Handlebars.revive({1:function(n,t,l,a,e){var o,s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(o=s(l,"if").call(null!=t?t:n.nullContext||{},null!=t?s(t,"viewerCanEdit"):t,{name:"if",hash:{},fn:n.program(2,e,0),inverse:n.noop,data:e,loc:{start:{line:11,column:4},end:{line:16,column:11}}}))?o:""},2:function(n,t,l,a,e){var o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<a role="button" class="action edit" tabindex="0">\n\t\t\t\t\t\t<svg class="icon icon-edit"><use xlink:href="#icon-edit"></use></svg>\n\t\t\t\t\t\t<span>'+n.escapeExpression((o(l,"intlMessage")||t&&o(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.EDIT"},data:e,loc:{start:{line:14,column:12},end:{line:14,column:51}}}))+"</span>\n\t\t\t\t\t</a>\n"},4:function(n,t,l,a,e){var o,s=null!=t?t:n.nullContext||{},i=n.hooks.helperMissing,c="function",r=n.escapeExpression,u=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<a role="button" class="action '+r(typeof(o=null!=(o=u(l,"action")||(null!=t?u(t,"action"):t))?o:i)===c?o.call(s,{name:"action",hash:{},data:e,loc:{start:{line:19,column:34},end:{line:19,column:44}}}):o)+'" tabindex="0">\n\t\t\t\t<svg class="icon icon-'+r(typeof(o=null!=(o=u(l,"icon")||(null!=t?u(t,"icon"):t))?o:i)===c?o.call(s,{name:"icon",hash:{},data:e,loc:{start:{line:20,column:26},end:{line:20,column:34}}}):o)+'"><use xlink:href="#icon-'+r(typeof(o=null!=(o=u(l,"icon")||(null!=t?u(t,"icon"):t))?o:i)===c?o.call(s,{name:"icon",hash:{},data:e,loc:{start:{line:20,column:59},end:{line:20,column:67}}}):o)+'"></use></svg>\n\t\t\t\t<span>'+r(typeof(o=null!=(o=u(l,"label")||(null!=t?u(t,"label"):t))?o:i)===c?o.call(s,{name:"label",hash:{},data:e,loc:{start:{line:21,column:10},end:{line:21,column:19}}}):o)+"</span>\n\t\t\t</a>\n"},compiler:[8,">= 4.3.0"],main:function(n,t,l,a,e){var o,s,i=null!=t?t:n.nullContext||{},c=n.hooks.helperMissing,r="function",u=n.escapeExpression,p=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="photo-list-header-action-bar '+u(typeof(s=null!=(s=p(l,"additionalClasses")||(null!=t?p(t,"additionalClasses"):t))?s:c)===r?s.call(i,{name:"additionalClasses",hash:{},data:e,loc:{start:{line:1,column:41},end:{line:1,column:62}}}):s)+'">\n\t<div class="action-bar-content">\n\t\t<div class="back-link-container">\n\t\t\t<a class="back-link" href="'+u(typeof(s=null!=(s=p(l,"backUrl")||(null!=t?p(t,"backUrl"):t))?s:c)===r?s.call(i,{name:"backUrl",hash:{},data:e,loc:{start:{line:4,column:30},end:{line:4,column:41}}}):s)+'">\n\t\t\t\t<svg class="icon icon-back"><use xlink:href="#icon-back"></use></svg>\n\t\t\t\t<span>'+u(typeof(s=null!=(s=p(l,"backToMessage")||(null!=t?p(t,"backToMessage"):t))?s:c)===r?s.call(i,{name:"backToMessage",hash:{},data:e,loc:{start:{line:6,column:10},end:{line:6,column:27}}}):s)+'</span>\n\t\t\t</a>\n\t\t</div>\n\t\t<div class="actions">\n'+(null!=(o=p(l,"if").call(i,null!=t?p(t,"signedIn"):t,{name:"if",hash:{},fn:n.program(1,e,0),inverse:n.noop,data:e,loc:{start:{line:10,column:3},end:{line:17,column:10}}}))?o:"")+(null!=(o=p(l,"each").call(i,null!=t?p(t,"actions"):t,{name:"each",hash:{},fn:n.program(4,e,0),inverse:n.noop,data:e,loc:{start:{line:18,column:3},end:{line:23,column:12}}}))?o:"")+'\t\t\t<a role="button" class="action share" tabindex="0">\n\t\t\t\t<svg class="icon icon-share_hollow"><use xlink:href="#icon-share_hollow"></use></svg>\n\t\t\t\t<span>'+u((p(l,"intlMessage")||t&&p(t,"intlMessage")||c).call(i,{name:"intlMessage",hash:{intlName:"share-modal.FLICKR_SHARE"},data:e,loc:{start:{line:26,column:10},end:{line:26,column:62}}}))+"</span>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n</div>\n"},useData:!0}),a={};n.Array.each([],(function(t){var l=n.Template.get("hermes/"+t);l&&(a[t]=l)})),n.Template.register("hermes/photo-list-action-bar",(function(t,e){return(e=e||{}).partials=e.partials?n.merge(a,e.partials):a,l(t,e)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-list-action-bar-view",(function(i,t){i.FlickrView.create(this.name,i.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){return this},buildContainer:function(i){return this.setContainerWithTemplate("photo-list-action-bar",i),this},activate:function(){var i=this.get("container");return this.actions=i.one(".actions"),this.actions&&(this.registerEventHandler(this.actions.delegate("click",this.handleActionClick.bind(this),".action")),this.registerEventHandler(this.actions.delegate("key",this.handleActionClick.bind(this),"down:13",".action"))),this}})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-action-bar"],optionalRequires:["hermes-core"],langBundles:["common","share-modal"]});YUI.add("photo-size-helper",(function(e,i){var n=require("hermes-core/flog")(i),t=[{name:"Square",length:75,key:"sq",suffix:"s",isSquare:!0},{name:"Large Square",length:150,key:"q",suffix:"q",isSquare:!0},{name:"Thumbnail",length:100,key:"t",suffix:"t"},{name:"Small",length:240,key:"s",suffix:"m"},{name:"Small 320",length:320,key:"n",suffix:"n"},{name:"Small 400",length:400,key:"w",suffix:"w"},{name:"Medium",length:500,key:"m",suffix:""},{name:"Medium 640",length:640,key:"z",suffix:"z"},{name:"Medium 800",length:800,key:"c",suffix:"c"},{name:"Large",length:1024,key:"l",suffix:"b"},{name:"Large 1600",length:1600,key:"h",suffix:"h"},{name:"Large 2048",length:2048,key:"k",suffix:"k"},{name:"X-Large 3K",length:3072,key:"3k",suffix:"3k"},{name:"X-Large 4K",length:4096,key:"4k",suffix:"4k"},{name:"VR 4K",length:4096,key:"f",suffix:"f",isVR:!0},{name:"X-Large 5K",length:5120,key:"5k",suffix:"5k"},{name:"X-Large 6K",length:6144,key:"6k",suffix:"6k"},{name:"Original",length:Number.MAX_VALUE,key:"o",suffix:"o",isOriginal:!0}];e.PhotoSizeHelper=function(i){return{getSizeConfig:function(e){return t.find((function(i){return i.key===e}))},getSize:function(e,i){return(i=i||[]).find((function(i){return i.key===e}))},getLargerSizeByScale:function(e,i){var n=this.getSizeConfig(e);return i=i||1.5,t.find((function(e){return!this.isASpecialSize(e)&&e.length>=i*n.length}),this)},isASpecialSize:function(e){return!!e.isSquare||(!!e.isVR||!!e.isOriginal)},getPhotoAspectRatio:function(e){var i=this.getBiggestGeneratedSize(e);return i.width/i.height},getBiggestGeneratedSize:function(e){var i,n=[];for(i in e)"o"!==i&&n.push(e[i]);return n.sort((function(e,i){return e.width<=i.width?1:-1})),n[0]},getSizeToFit:function(i,t,r){var s,a,u,h=t.width,f=t.height,g=!!r.cropToFit,o=r.includeSquare,l=r.excludeSizes||["o"],c=r.includeSizes,d=this.isPhotoSquare(i);if(void 0===r.includeSizes)try{c=Object.keys(i)}catch(e){n.warn("getSizeToFit with invalid sizes",{err:e,sizes:i})}return e.Object.each(i,(function(e,i){var n,t,r,S,m;e&&-1===l.indexOf(i)&&c.indexOf(i)>-1&&(o||!this.isSquareType(i)||d)&&(n=parseInt(e.width,10),t=parseInt(e.height,10),(g&&n>=h&&t>=f||!g&&(n>=h||t>=f))&&(r=!0),r&&(s?t<parseInt(s.height,10)&&(s=e):s=e),a?(S=parseInt(a.width,10),m=parseInt(a.height,10),(n>S||t>m)&&(a=e)):a=e),u=s||a}),this),u},isSquareType:function(e){return["sq","q"].indexOf(e)>-1},hasSquareDimensions:function(e){return parseInt(e.width,10)/parseInt(e.height,10)==1},isPhotoSquare:function(i){var n=!0;return e.Object.some(i,(function(e,i){if(e&&e.width&&e.height&&1!==parseInt(e.width,10)/parseInt(e.height,10))return n=!1,!0}),this),n},parseApiSizes:function(i,n){return e.APIHelper.response.parsePhotoSize(i,n)},getDownloadUrl:function(e,i,n){const t=i.match(/([^/_]+)_([^/_]+)_([^/_]+)\.[^.]+$/);return t&&4!==!t.length?`/photo_download.gne?id=${t[1]}&secret=${t[2]}&size=${e}${n?`&source=${n}`:""}`:i},getLargestDownloadUrl:function(e,i){const n=e.getValue("upgradeSizes"),t=e.getValue("ascendingSizes").map((e=>e.key)),r=t.filter((e=>!n.includes(e))),s=r[r.length-1],a=e.getValue("sizes")[s];return this.getDownloadUrl(s,a.displayUrl,i)}}}}),"@VERSION@",{requires:["api-helper"],optionalRequires:["hermes-core"]});YUI.add("album-action-bar-view",(function(e,t){e.FlickrView.create(this.name,e.namespace("Views")["photo-list-action-bar-view"],[],{langBundles:this.details.langBundles,initializer:function(e){return this.albumId=e.albumId,this.nsidOrPathAlias=e.nsidOrPathAlias,this.constructor.superclass.initializer.call(this,e)},loadState:function(){var t=[];return t.push(this.appContext.getModel("set-models",this.albumId).then((e=>{this.set("albumModel",e)}))),e.Promise.all(t)},buildContainer:function(){var e=this.get("albumModel"),t=this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===e.getValue("owner").id,i="/photos/"+this.nsidOrPathAlias+"/albums/with/"+this.albumId,o=[];e.getValue("canDownload")&&o.unshift({action:"download",icon:"download_hollow",label:this.intlMessage({intlName:"common.DOWNLOAD"})}),t&&o.unshift({action:"photobook",icon:"book",label:this.intlMessage({intlName:"wallet.ORDERS_PHOTO_BOOK"})});var a={actions:o,backUrl:i,backToMessage:this.intlMessage({intlName:"album-page.BACK_TO_ALBUMS"}),signedIn:this.appContext.getViewer().signedIn,viewerCanEdit:t&&!e.getValue("isAutoUploadSet")};return this.constructor.superclass.buildContainer.call(this,a)},activate:function(){var t=this.get("container");this.get("prefsModel");this.actions=t.one(".actions"),this.downloadLink=this.actions.one(".action.download"),this.downloadLink&&(this.bulkDownloaderView=new e.BulkDownloaderView({appContext:this.appContext})),this.constructor.superclass.activate.call(this)},handleActionClick:function(e){e.target.ancestor(".action.share",!0)?this.showShareModal(e.target):e.target.ancestor(".action.download",!0)?this.downloadAlbum(e):e.target.ancestor(".action.photobook",!0)?this.createBookFromAlbum(e):e.target.ancestor(".action.edit",!0)&&this.showEditModal(e)},showShareModal:function(t){var i=new e.Views["fluid-share-album-view"]({appContext:this.appContext,albumId:this.albumId});i.initialize().then((function(){return i.prepareModal(t)}))},downloadAlbum:function(t){var i,o=this.get("albumModel");if(this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===o.getValue("owner").id&&this.bulkDownloaderView.set("isOwnAlbum",!0),1===o.getValue("totalCount"))return o.getValue("photoPageList").getPage({page:1,perPage:1}).then((t=>{let i,o=t[0];if(o.getValue("isVideo")&&!this.appContext.flipper.isFlipped("disable-video-playback"))i="/video_download.gne?id="+o.id;else{i=new e.PhotoSizeHelper(this.appContext).getLargestDownloadUrl(o,"singlePhotoAlbum")}e.config.doc.location.href=i}));o.getValue("totalCount")>e.config.flickr.downloadr.max_album_items?new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,showCancelButton:!1,title:this.intlMessage({intlName:"downloadr.TOO_MANY_TITLE"}),htmlMessage:this.intlMessage({intlName:this.bulkDownloaderView.get("isOwnAlbum")?"downloadr.ALBUM_TOO_MANY_OWN":"downloadr.ALBUM_TOO_MANY_OTHER",username:o.getValue("owner").getValue("displayname"),userurl:o.getValue("owner").getValue("url"),url:"/photos/organize?start_tab=one_set"+o.id})}),hasSubviewConfigRefactor:!0}).show():(i=this.bulkDownloaderView.createTitle(o.getValue("photoCount"),o.getValue("videoCount")),this.bulkDownloaderView.showDownloadDialog({title:i,setID:this.albumId}))},createBookFromAlbum:function(){this.appContext.flapp.navigate("/create")},getDescription:function(){return this.get("albumModel").getValue("description")},handleAlbumModelValuesChanged:function(e){var t=this.get("container"),i=t.one(".title"),o=t.one(".photo-count");e.title&&i&&(i.set("text",e.title.newVal),this.changeTitle()),e.description&&this.changeDescription(e.description.newVal),e.photoAndVideosDisplay&&o&&o.set("text",e.photoAndVideosDisplay.newVal)},showEditModal:function(){var t=this.get("albumModel"),i=new e.Views["album-edit-view"]({appContext:this.appContext,nsidOrPathAlias:this.nsidOrPathAlias,albumModel:t,title:this.intlMessage({intlName:"album-page.EDIT_ALBUM"}),curationTitle:this.storedEditMeta?this.storedEditMeta.title:t.getValue("title"),curationDescription:this.storedEditMeta?this.storedEditMeta.description:t.getValue("description"),coverPhotoId:this.storedCoverPhotoId?this.storedCoverPhotoId:t.getValue("primary"),deleteMessage:this.intlMessage({intlName:"album-page.DELETE_ALBUM"}),confirmDeleteMessage:this.intlMessage({intlName:"album-page.CONFIRM_ALBUM_DELETE_NO_CONTENTS_DELETED"})});this.storedEditMeta=null,this.editModal=new e.Views.FluidModal({appContext:this.appContext,subview:i,width:600,classList:["curation-edit-view"],focusOnFirstTabPress:!1,hasSubviewConfigRefactor:!0}).show(),i.registerEventHandler(e.on("curationEdit:coverPhotoClicked",(e=>{var t=this.storedCoverPhotoId;this.storedEditMeta=e.storedEditMeta,this.editModal.close(),setTimeout((()=>{this.storedCoverPhotoId=t,this.showPhotoPicker()}),1)}))),i.registerEventHandler(e.on("curationEdit:deleteClicked",(e=>{this.storedEditMeta=e.storedEditMeta})))},showPhotoPicker:function(){var t=this.get("albumModel"),i={appContext:this.appContext,enableVideos:!0,searchable:{yours:!0}};i.defaultSelected={id:t.getValue("id"),title:t.getValue("title"),type:"set"};var o=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],a=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0}],s=[{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0},{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}];return this.appContext.getModel("photo-models",t.getValue("primary")).then((t=>{i.preSelectedPhotos=[t],i.navBarConfig={appContext:this.appContext,enableSearch:!0,links:s,breakpointConfig:[{maxWidth:700,links:o,enableSearch:!1},{maxWidth:500,links:a,enableSearch:!1}],onClose:e=>{this.photoPicker.close()}},i.onConfirm=e=>{var t=this.photoPicker.get("subview").get("selected");this.storedCoverPhotoId=t,this.photoPicker.close()},i.initialButtonState={confirm:""};let n=new e.Views["photo-selector-view"](i);this.photoPicker=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,subview:n,width:Math.round(.8*Math.max(1280,e.config.win.innerWidth)),height:Math.round(e.config.win.innerHeight-60),fullWindow:!0,classList:"photo-selector album-coverphoto-selector",hasSubviewConfigRefactor:!0,flexLayout:!0}).show(),this.photoPicker.registerEventHandler(e.on("photoSelector:selected",(e=>{n.confirmView.setButtonState({confirm:""})}))),this.photoPicker.registerEventHandler(e.on("photoSelector:unselected",(e=>{n.confirmView.setButtonState({confirm:"disabled"})}))),this.photoPicker.on("close",(()=>{setTimeout(this.showEditModal.bind(this),1)}))}))}})}),"@VERSION@",{requires:["flickr-view","album-edit-view","fluid-share-album-view","photo-list-action-bar-view","photo-size-helper"],optionalRequires:["hermes-core"],optional:["set-models"],langBundles:["common","album-page","wallet","global-nav","downloadr"]});YUI.add("photo-card-helper",(function(e,t){e.mix({langBundles:["common","feed","feed-new"]},e.Localizable);var o=require("justified-layout");e.PhotoCardHelper=function(t){var i={layoutValues:{large:{BATCH_CARD_SPACING:4,BATCH_TARGET_ROW_HEIGHT:150,BATCH_TARGET_ROW_HEIGHT_TOLERANCE:.3,BATCH_ROW_HEIGHT_RATIO:.5},medium:{BATCH_CARD_SPACING:4,BATCH_TARGET_ROW_HEIGHT_TOLERANCE:.3},compact:{BATCH_CARD_SPACING:8,BATCH_TARGET_ROW_HEIGHT:180,BATCH_TARGET_ROW_HEIGHT_TOLERANCE:.3,SINGLE_PHOTO_HEIGHT:250}},ATTRIBUTION_HEADER_HEIGHT:58,DETAILS_FOOTER_HEIGHT:70,INFO_BAR_HEIGHT:52,MAX_PHOTO_AR:2.5,MIN_PHOTO_AR:.5,MANUAL_PORTRAIT_AR:.75,MANUAL_LANDSCAPE_AR:2,getCappedPhotoHeight:function(e){e.height;return Math.min(e.height,Math.max(t.viewportData.getHeight()*e.viewportProportion-e.additionalCardHeight,e.minHeight))},getClampedPhotoAspectRatio:function(e){return Math.min(Math.max(e,this.MIN_PHOTO_AR),this.MAX_PHOTO_AR)},generateCompactBatchLayout:function(e){var t,i,a=this,n=1===e.photoItems.length?this.layoutValues.compact.SINGLE_PHOTO_HEIGHT:this.layoutValues.compact.BATCH_TARGET_ROW_HEIGHT;t=e.photoItems.map((function(e){return a.getClampedPhotoAspectRatio(e.aspectRatio)})),(i=o(t,{containerWidth:e.width,containerPadding:0,boxSpacing:{horizontal:this.layoutValues.compact.BATCH_CARD_SPACING,vertical:this.layoutValues.compact.BATCH_CARD_SPACING},targetRowHeight:n,targetRowHeightTolerance:this.layoutValues.compact.BATCH_TARGET_ROW_HEIGHT_TOLERANCE})).width=e.width;var u=i.boxes[0].top,l=[0],s=0;return i.boxes.some((function(e,t){if(e.top>u){if(s+=i.boxes[l[l.length-1]].height+a.layoutValues.compact.BATCH_CARD_SPACING,l.push(t),l.length>3)return!0;u=e.top}})),l.length>3&&(i.boxes=i.boxes.slice(0,l[l.length-1]),i.containerHeight=s),i},generateThreeMaxLayout:function(e){var o=this,i={},a=[],n=[],u=e.photoItems.length;return 2===(n=(n=e.photoItems.map((function(e){return o.getClampedPhotoAspectRatio(e.aspectRatio)}))).slice(0,3)).length?n[0]>1&&n[1]>1?(a.push(n.slice(0,1)),a.push(n.slice(1,2)),i=this.buildCustomRowsLayout(a,e)):(a.push(n.slice(0,2)),i=this.buildCustomRowsLayout(a,e)):3===n.length&&(n[0]>1&&n[1]>1&&n[2]>1||n[0]>1&&n[1]>1&&n[2]<=1||n[0]>1&&n[1]<=1&&n[2]>1||n[0]>1&&n[1]<=1&&n[2]<=1?(a.push(n.slice(0,1)),a.push(n.slice(1,3)),i=this.buildCustomRowsLayout(a,e)):n[0]<=1&&n[1]>1&&n[2]>1?(u>3?a.push(n.slice(0,2)):(a.push(n.slice(0,2)),a.push(n.slice(2,3))),i=this.buildCustomRowsLayout(a,e)):n[0]<=1&&n[1]>1&&n[2]<=1?(a.push(n.slice(0,2)),i=this.buildCustomRowsLayout(a,e)):n[0]<=1&&n[1]<=1&&n[2]>1?(u>3?a.push(n.slice(0,2)):(a.push(n.slice(0,2)),a.push(n.slice(2,3))),i=this.buildCustomRowsLayout(a,e)):n[0]<=1&&n[1]<=1&&n[2]<=1&&(a.push(n.slice(0,3)),i=this.buildCustomRowsLayout(a,e))),Math.max.apply(Math,i.boxes.map((function(e){return e.height})))>.8*t.viewportData.getHeight()&&((a=[]).push(n.slice(0,2)),i=this.buildCustomRowsLayout(a,e)),i},buildCustomRowsLayout:function(e,t){var o=this,i=0,a={boxes:[]};return e.forEach((function(n,u){var l={horizontal:o.layoutValues.large.BATCH_CARD_SPACING,vertical:o.layoutValues.large.BATCH_CARD_SPACING},s=o.generateCustomJustifiedRow(n,{containerWidth:t.width,padding:l.horizontal,top:0===u?0:i});a.boxes=a.boxes.concat(s),i+=u!==e.length-1?s[0].height+l.vertical:s[0].height})),a.containerHeight=i,a},generateCustomJustifiedRow:function(e,t){var o=e.reduce((function(e,t,o){return e+t}),0),i=(t.containerWidth-t.padding*(e.length-1))/o,a=0;return e.map((function(e,o){var n=a;return a+=i*e+t.padding,{aspectRatio:e,width:i*e,height:i,left:n,top:t.top}}))},scaleLayout:function(e,t,o,i,a){var n,u=0,l=0,s=[];return e.boxes.forEach((function(e,o){i||(e.width*=t,e.left*=t),a||(e.height*=t,e.top*=t)})),s.push([]),e.boxes.forEach((function(e,t){e.top>l&&(u++,l=e.top,s.push([])),s[u].push(e)})),n=0,s.forEach((function(u,l){var r=o,g=r*t,h=0;u.forEach((function(e,t){i||(e.width-=(r-g)*(u.length-1)/u.length,e.left=h+t*r,h+=e.width),a||(e.height-=(r-g)*(s.length-1)/s.length,e.top=n+l*r,t===u.length-1&&(n+=u[0].height))})),i||(e.width=h+(u.length-1)*r)})),a||(e.containerHeight=n+(s.length-1)*o),e},convertPhotoModel:function(t){var o,i=t.getValue("owner"),a=t.getValue("engagement"),n=i.getValue("isPro");return"photo-lite-models"===t.registry.name?(o=this.convertEngagementModel(t),{id:e.guid(),layoutRenderType:"photo",photoId:t.getValue("id"),aspectRatio:t.getValue("aspectRatio"),sizes:t.getValue("sizes"),url:t.getValue("url"),title:t.getValue("title"),description:t.getValue("description"),mediaType:t.getValue("mediaType"),contentType:t.getValue("contentType"),isVideo:t.getValue("isVideo"),owner:{nsid:i.getValue("nsid"),url:i.getValue("url"),displayname:i.getValue("displayname"),pathAlias:i.getValue("pathAlias"),isPro:n,proBadgeType:n?i.getValue("proBadge"):void 0,model:t.getValue("owner")},engagement:o,isOwner:t.getValue("isOwner"),needsInterstitial:t.getValue("needsInterstitial"),model:t,engagementModel:a}):(o=this.convertEngagementModel(a),{id:e.guid(),layoutRenderType:"photo",photoId:t.getValue("id"),aspectRatio:t.getValue("aspectRatio"),sizes:t.getValue("sizes"),url:t.getValue("url"),title:t.getValue("title"),description:t.getValue("description"),mediaType:t.getValue("mediaType"),contentType:t.getValue("contentType"),isVideo:t.getValue("isVideo"),owner:{nsid:i.getValue("nsid"),url:i.getValue("url"),displayname:i.getValue("displayname"),buddyicon:i.getValue("buddyicon"),pathAlias:i.getValue("pathAlias"),isPro:n,proBadgeType:n?i.getValue("proBadge"):void 0,model:t.getValue("owner")},engagement:o,isOwner:t.getValue("isOwner"),needsInterstitial:t.getValue("needsInterstitial"),safetyLevel:t.getValue("safetyLevel"),model:t,engagementModel:a})},convertEngagementModel:function(e){return"photo-lite-models"===e.registry.name?{photoId:e.getValue("id"),isFaved:e.getValue("isFaved"),faveCount:e.getValue("faveCount"),commentCount:e.getValue("commentCount"),canFave:e.getValue("canFave"),reactions:t.flipper.isFlipped("enable-likes")?e.getValue("reactions"):void 0,model:e}:{photoId:e.getValue("id"),isFaved:e.getValue("isFaved"),faveCount:e.getValue("faveCount"),commentCount:e.getValue("commentCount"),viewCount:e.getValue("viewCount"),canFave:e.getValue("canFave"),reactions:t.flipper.isFlipped("enable-likes")?e.getValue("reactions"):void 0,model:e}},checkInsideViewport:function(t,o,i){var a=t?t.getDOMNode().getBoundingClientRect():void 0;if(o=o||0,a&&a.height>0){if(i&&a.top>=-o&&a.bottom<=e.config.win.innerHeight+o)return!0;if(!i&&a.bottom>=-o&&a.top<=e.config.win.innerHeight+o)return!0}return!1}};return e.augment(i,e.EventTarget),i}}),"@VERSION@",{requires:["event-custom","storage-helper"],optionalRequires:["hermes-core"]});YUI.add("hermes-template-infinite-scroll-load-more",(function(e,a){var t=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,t,n,l){var r=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<div class="infinite-scroll-load-more">\n\t<button class="alt">'+e.escapeExpression((r(t,"intlMessage")||a&&r(a,"intlMessage")||e.hooks.helperMissing).call(null!=a?a:e.nullContext||{},{name:"intlMessage",hash:{intlName:"common.LOAD_MORE_RESULTS"},data:l,loc:{start:{line:2,column:21},end:{line:2,column:72}}}))+"</button>\n</div>"},useData:!0}),n={};e.Array.each([],(function(a){var t=e.Template.get("hermes/"+a);t&&(n[a]=t)})),e.Template.register("hermes/infinite-scroll-load-more",(function(a,l){return(l=l||{}).partials=l.partials?e.merge(n,l.partials):n,t(a,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-license-detail",(function(e,a){var l=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,l,n,t){var s=null!=a?a:e.nullContext||{},r=e.hooks.helperMissing,i=e.escapeExpression,o=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<p class="secondary" style="margin-top: 0;">'+i((o(l,"intlMessage")||a&&o(a,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:null!=a?o(a,"title"):a},data:t,loc:{start:{line:1,column:44},end:{line:1,column:74}}}))+'</p>\n<p class="secondary" style="margin-bottom: 0;">'+i((o(l,"intlMessage")||a&&o(a,"intlMessage")||r).call(s,{name:"intlMessage",hash:{intlName:null!=a?o(a,"body"):a},data:t,loc:{start:{line:2,column:47},end:{line:2,column:76}}}))+"</p>\n"},useData:!0}),n={};e.Array.each([],(function(a){var l=e.Template.get("hermes/"+a);l&&(n[a]=l)})),e.Template.register("hermes/license-detail",(function(a,t){return(t=t||{}).partials=t.partials?e.merge(n,t.partials):n,l(a,t)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-list-layout-row",(function(t){(t.PhotoListLayoutRow=function(t){this.top=t.top,this.left=t.left,this.width=t.width,this.spacing=t.spacing,this.targetRowHeight=t.targetRowHeight,this.targetRowHeightTolerance=t.targetRowHeightTolerance,this.additionalHeight=t.additionalHeight||0,this.minAspectRatio=this.width/t.targetRowHeight*(1-t.targetRowHeightTolerance),this.maxAspectRatio=this.width/t.targetRowHeight*(1+t.targetRowHeightTolerance),this.edgeCaseMinRowHeight=t.edgeCaseMinRowHeight||Number.NEGATIVE_INFINITY,this.edgeCaseMaxRowHeight=t.edgeCaseMaxRowHeight||Number.POSITIVE_INFINITY,this.rightToLeft=t.rightToLeft,this.isBreakoutRow=t.isBreakoutRow,this.staticViewsConfig=t.staticViewsConfig,this.items=[],this.height=0}).prototype={addItem:function(i){var e,h,s,o=this.items.concat(i),a=this.width-(o.length-1)*this.spacing,g=o.reduce((function(t,i){return t+i.aspectRatio}),0),n=a/this.targetRowHeight;return i.isStaticItem&&this.staticViewsConfig&&this.staticViewsConfig.isFullRow?0===this.items.length&&(this.items.push(t.merge(i)),this._completeLayout(i.fullRowMinHeight||this.targetRowHeight),!0):(this.isBreakoutRow||this.isStaticItem&&!this.staticViewsConfig.isFullRow)&&0===this.items.length&&i.aspectRatio>=1?(this.items.push(t.merge(i)),this._completeLayout(a/i.aspectRatio),!0):0!==g&&(g<this.minAspectRatio?(this.items.push(t.merge(i)),!0):g>this.maxAspectRatio?i.isStaticItem||0===this.items.length?(this.items.push(t.merge(i)),this._completeLayout(a/g),!0):(e=this.width-(this.items.length-1)*this.spacing,h=this.items.reduce((function(t,i){return t+i.aspectRatio}),0),s=e/this.targetRowHeight,Math.abs(g-n)>Math.abs(h-s)?(this._completeLayout(e/h),!1):(this.items.push(t.merge(i)),this._completeLayout(a/g),!0)):(this.items.push(t.merge(i)),this._completeLayout(a/g),!0))},forceComplete:function(t,i){var e=this.width-(this.items.length-1)*this.spacing,h=this.items.reduce((function(t,i){return t+i.aspectRatio}),0);"number"==typeof i?this._completeLayout(i-this.additionalHeight,!1):t?this._completeLayout(e/h):this._completeLayout(this.targetRowHeight-this.additionalHeight,!1)},isLayoutComplete:function(){return this.height>0},getItems:function(){return this.rightToLeft?this.items.reverse():this.items},getIndexOfItem:function(t){var i=-1;return this.items.some((function(e,h){if(e.id===t)return i=h,!0})),i},setTop:function(t){this.top=t,this.items.forEach((function(i){i.geometry.top=t}))},_completeLayout:function(t,i){var e,h,s,o,a,g,n=this.rightToLeft?-this.left:this.left,r=this.width-(this.items.length-1)*this.spacing,m=this;void 0===i&&(i=!0),(h=Math.round(t))!==(s=Math.max(this.edgeCaseMinRowHeight,Math.min(h,this.edgeCaseMaxRowHeight)))?(this.height=s,e=r/s/(r/h)):(this.height=h,e=1),this.items.forEach((function(t,i){t.geometry={top:m.top,width:Math.round(t.aspectRatio*m.height*e),height:m.height+m.additionalHeight},m.rightToLeft?t.geometry.left=m.width-n-t.geometry.width:t.geometry.left=n,n+=t.geometry.width+m.spacing})),this.height+=m.additionalHeight,i&&(this.rightToLeft||(n-=this.spacing+this.left),o=(n-this.width)/this.items.length,a=this.items.map((function(t,i){return Math.round((i+1)*o)})),1===this.items.length?((g=this.items[0].geometry).width-=Math.round(o),this.rightToLeft&&(g.left+=Math.round(o))):this.items.forEach((function(t,i){i>0?(t.geometry.left-=a[i-1],t.geometry.width-=a[i]-a[i-1]):t.geometry.width-=a[i]})))}}}),"@VERSION@",{requires:[]});