YUI.add("albums-list-route",(function(e){var t=require("hermes-core/type-validator"),a=50,s=100;function o(e){o.superclass.constructor.call(this,e)}e.Routes[this.name]=o,e.extend(o,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(o){var i,r,n,l=this,u={},p=o.params.nsid_or_path_alias,m=o.params&&o.params.set_id,d=m?s:25,g=this.getPageNumber(o),c=o.geo;return t.nsid(p)?u.id=p:u.pathAlias=p,r="/photos/"+p+"/albums/",i={page:s/d*(g-1)+1,perPage:d,withSetId:m},e.Promise.all([this.appContext.getModel("sets-models",u,i),this.appContext.getModel("person-models",u),this.appContext.getModel("person-contacts-count-models",u)]).then((function(u){var d=u[0],h=u[1],v=0;if(YUI.Env.isServer&&(v=Math.ceil(d.getValue("totalItems")/s),g>v&&i.page>1&&!isNaN(parseInt(o.params.page_number,10))))return e.Promise.resolve({redirect:r.replace(/page[0-9]+/,"")});if(m){var f=d.getValue("albumsList");if(-1===(n=f.getPageOf({id:m},a))||f.getNextIncompletePage(i)===n)return i.forceAPICall=!0,t.nsid(p)?i.id=p:i.pathAlias=p,f.getPage(i).then((function(e){return g=Math.ceil(f.getPageOf({id:m},a)*a/s),n=g,l.onRouteResolved(d,h,g,n,r,m,c)}),(function(t){return e.Promise.resolve({redirect:r})}));g=Math.ceil(n*a/s),n=g}else n=2*(g-1)+1;return l.onRouteResolved(d,h,g,n,r,m,c)}),(function(t){return t&&m?e.Promise.resolve({redirect:r}):t.timeout?l.appContext.getModel("person-models",u).then((function(t){var a=t.getValue("displayname"),s={view:"empty-page-view",title:l.intlMessage({intlName:"common.USERS_ALBUMS",who:a}),params:{isSlow:!0,page:"albums",displayName:a,nsid:t.getValue("nsid")}};return e.Promise.resolve(s)}),(function(){return l.onRouteRejected(t,o)})):l.onRouteRejected(t,o)}))},onRouteResolved:function(t,o,i,r,n,l,u){var p,m=t.getValue("totalItems"),d=o.getValue("displayname");return p=0===parseInt(m,10)?{view:"empty-page-view",title:this.intlMessage({intlName:"common.USERS_ALBUMS",who:d}),params:{displayName:d,nsid:o.getValue("nsid"),page:"albums",geo:u,hasPhotos:o.getValue("uploadCount")>0}}:{view:"albums-list-page-view",title:this.intlMessage({intlName:"common.USERS_ALBUMS",who:d}),params:{nsid:t.id,withSetId:l,pageParams:{page:r,perPage:l?s:a,viewPageSize:s,nominalPage:i},geo:u,baseURL:n,ownerIsPro:this.appContext.flipper.isFlipped("enable-skybox-gn-refactor")&&o.getValue("isPro")}},e.Promise.resolve(p)},onRouteRejected:function(t,a){if(t.fatal)throw t;return this.displayRouteErrors(a,new e.RouteError(404,this.intlMessage({intlName:"common.404_PERSON_NONEXISTENT"})))}}),e.mix(o.prototype,e.Localizable)}),"@VERSION@",{requires:["flickr-route","flickr-promise","sets-models","person-models"],langBundles:["common"]});