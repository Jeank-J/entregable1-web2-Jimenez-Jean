YUI.add("hermes-template-prepare-print-modal",(function(e,t){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,a,n,l){var s,i=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,o=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="prepare-print-modal-container loading">\n\t<div class="loading-container">\n\t\t<span class="preparing-text">'+o((c(a,"intlMessage")||t&&c(t,"intlMessage")||r).call(i,{name:"intlMessage",hash:{intlName:"prints.PREPARING_YOUR_PHOTO"},data:l,loc:{start:{line:3,column:31},end:{line:3,column:85}}}))+'</span>\n\t\t<span class="flickr-balls-container">\n'+(null!=(s=e.invokePartial(c(n,"flickr-balls"),t,{name:"flickr-balls",data:l,indent:"\t\t\t",helpers:a,partials:n,decorators:e.decorators}))?s:"")+'\t\t</span>\n\t</div>\n\t<div class="error-container">\n\t\t<h1>'+o((c(a,"intlMessage")||t&&c(t,"intlMessage")||r).call(i,{name:"intlMessage",hash:{intlName:"common.OOPS"},data:l,loc:{start:{line:9,column:6},end:{line:9,column:44}}}))+'</h1>\n\t\t<p class="error-message"></p>\n\t\t<div class="button-container">\n\t\t\t<button class="mini alt cancel-button">'+o((c(a,"intlMessage")||t&&c(t,"intlMessage")||r).call(i,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:l,loc:{start:{line:12,column:42},end:{line:12,column:82}}}))+'</button>\n\t\t\t<button class="mini action retry-button">'+o((c(a,"intlMessage")||t&&c(t,"intlMessage")||r).call(i,{name:"intlMessage",hash:{intlName:"common.RETRY"},data:l,loc:{start:{line:13,column:44},end:{line:13,column:83}}}))+"</button>\n\t\t</div>\n\t</div>\n</div>"},usePartial:!0,useData:!0}),n={};e.Array.each(["flickr-balls"],(function(t){var a=e.Template.get("hermes/"+t);a&&(n[t]=a)})),e.Template.register("hermes/prepare-print-modal",(function(t,l){return(l=l||{}).partials=l.partials?e.merge(n,l.partials):n,a(t,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-flickr-balls"]});YUI.add("prepare-print-modal-view",(function(e,r){require("hermes-core/flog")(r);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){},buildContainer:function(){this.setContainerWithTemplate("prepare-print-modal")},activate:function(){var e=this,r=this.get("container");this.contentContainer=r.one(".prepare-print-modal-container"),this.loadingContainer=r.one(".loading-container"),this.errorContainer=r.one(".error-container"),this.errorTextContainer=this.errorContainer.one(".error-message"),this.errorRetryButton=this.errorContainer.one("button.retry-button"),this.errorCancelButton=this.errorContainer.one("button.cancel-button"),this.registerEventHandler(this.errorRetryButton.on("click",(function(){e.fire("retryClicked")}))),this.registerEventHandler(this.errorCancelButton.on("click",(function(){e.fire("closeClicked")})))},showError:function(e){this.contentContainer.removeClass("loading"),this.contentContainer.addClass("error"),e&&this.errorTextContainer.set("text",e)},showLoading:function(){this.contentContainer.addClass("loading"),this.contentContainer.removeClass("error")}})}),"@VERSION@",{requires:["flickr-view","hermes-template-prepare-print-modal"],optionalRequires:["hermes-core"],langBundles:["common","prints"]});YUI.add("print-button-view",(function(t,i){require("hermes-core/flog")(i);t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){this.params=i,this.disableClicks=i.disableClicks,this.iconSize=void 0!==i.iconSize?i.iconSize:"normal",this.photoPrintsHelper=new t.PhotoPrintsHelper(this.appContext),this.selectors={printButton:".print-button-container .print-button",newLabel:".print-button-container .label-beta"}},loadState:function(){var t=this;return this.appContext.getModel("photo-models",this.params.photoId).then((function(i){t.photoModel=i}))},buildContainer:function(){this.setContainerWithTemplate("print-button",{iconSize:this.iconSize})},activate:function(){var t=this.get("container");this.printButtonNode=t.one(this.selectors.printButton),this.printNewLabelNode=t.one(this.selectors.newLabel),this.disableClicks||(this.printButtonNode&&this.registerEventHandler(this.printButtonNode.on("click",this.handlePrintClick.bind(this))),this.printNewLabelNode&&this.registerEventHandler(this.printNewLabelNode.on("click",this.showPrintTooltip.bind(this))))},handlePrintClick:function(){"en-us"===this.appContext.lang.toLowerCase()?this.preparePrint():this.showEnglishWarningModal()},preparePrint:function(){var i=this;this.showPreparingPrintModal(),this.photoPrintsHelper.registerPrint(this.photoModel,t.config.win.location.href).then((function(i){t.config.win.location.href=i.redirectURL})).catch((function(t){i.preparePrintModalSubview.showError(t.message||i.intlMessage({intlName:"prints.SOMETHING_WRONG_PREPARING_PRINT"}))}))},showEnglishWarningModal:function(i){var e=this;this.englishWarningModal=new t.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,showActionButton:!0,actionButtonLabel:this.intlMessage({intlName:"prints.CONTINUE_IN_ENGLISH"}),showCancelButton:!0,cancelButtonLabel:"en-us"===this.appContext.lang.toLowerCase()?this.intlMessage({intlName:"common.GO_BACK_BUTTON"}):this.intlMessage({intlName:"common.CANCEL"}),showCancelX:!1,showHeader:!0,showFooter:!0,title:this.intlMessage({intlName:"prints.ENGLISH_LANGUAGE_AHEAD"}),htmlMessage:this.intlMessage({intlName:"prints.ORDERING_IS_ENGLISH_ONLY"})}),this.englishWarningModal.show(),this.englishWarningModal.on("actionClick",(function(){e.englishWarningModal.close(),setTimeout((function(){e.preparePrint()}),0)}))},showPreparingPrintModal:function(){var i=this;this.preparePrintModalSubview=new t.Views["prepare-print-modal-view"]({appContext:this.appContext}),this.preparingPrintModal=new t.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,subview:this.preparePrintModalSubview,hasSubviewConfigRefactor:!0}),this.preparingPrintModal.show(),this.preparePrintModalSubview.on("retryClicked",(function(){i.preparingPrintModal.close(),setTimeout((function(){i.preparePrint()}),0)})),this.preparePrintModalSubview.on("closeClicked",(function(){i.preparingPrintModal.close()}))},showPrintTooltip:function(){var i,e=this,n=this.printButtonNode;n&&(this.tooltip=new t.Views.FluidDroparound({appContext:this.appContext,htmlMessage:this.templates("print-icon-tooltip")({}),showDropArrow:!0,dismissOnOverlayClick:!0,observePageResize:!0,anchorElement:n,keyboardAnchorElement:n,minVerticalSpace:400,width:300,positionFixed:!0,preferLeft:!0,closeOnScroll:!0,anchorOffsetVertical:0}),i=this.tooltip.get("container"),this.registerEventHandler(i.delegate("click",(function(t){e.tooltip.close()}),".close-x-button")),this.tooltip.show())}})}),"@VERSION@",{requires:["flickr-view","hermes-template-print-button","hermes-template-print-icon-tooltip","prepare-print-modal-view","photo-prints-helper"],optionalRequires:["hermes-core"],optional:["photo-models"],langBundles:["common","prints"]});YUI.add("hermes-template-photo-page-download-interstitial",(function(t,n){var l=t.Template.Handlebars.revive({1:function(t,n,l,e,a){var s,i=null!=n?n:t.nullContext||{},o=t.hooks.helperMissing,r="function",c=t.escapeExpression,p=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'\t\t\t<div class="gift-pro-container">\n\t\t\t\t<div class="owner-avatar">\n\t\t\t\t\t<a class="avatar person medium"\n\t\t\t\t\t\trel="author"\n\t\t\t\t\t\thref="'+c(typeof(s=null!=(s=p(l,"pathAlias")||(null!=n?p(n,"pathAlias"):n))?s:o)===r?s.call(i,{name:"pathAlias",hash:{},data:a,loc:{start:{line:8,column:12},end:{line:8,column:25}}}):s)+'"\n\t\t\t\t\t\tdata-person-nsid="'+c(typeof(s=null!=(s=p(l,"nsid")||(null!=n?p(n,"nsid"):n))?s:o)===r?s.call(i,{name:"nsid",hash:{},data:a,loc:{start:{line:9,column:24},end:{line:9,column:32}}}):s)+'"\n\t\t\t\t\t\tstyle="background-image: url('+c(typeof(s=null!=(s=p(l,"buddyIcon")||(null!=n?p(n,"buddyIcon"):n))?s:o)===r?s.call(i,{name:"buddyIcon",hash:{},data:a,loc:{start:{line:10,column:35},end:{line:10,column:48}}}):s)+');"\n\t\t\t\t\t\ttabindex="0">\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<p class="appreciation-title">\n\t\t\t\t\t'+c((p(l,"intlMessage")||n&&p(n,"intlMessage")||o).call(i,{name:"intlMessage",hash:{username:null!=n?p(n,"displayName"):n,intlName:"photo-page-scrappy.DOWNLOAD_MODAL_SAY_THX"},data:a,loc:{start:{line:15,column:5},end:{line:15,column:94}}}))+'\n\t\t\t\t</p>\n\t\t\t\t<p class="appreciation-body">\n\t\t\t\t\t'+c((p(l,"intlMessage")||n&&p(n,"intlMessage")||o).call(i,{name:"intlMessage",hash:{username:null!=n?p(n,"displayName"):n,intlName:"photo-page-scrappy.DOWNLOAD_MODAL_WHILE_GIFT"},data:a,loc:{start:{line:18,column:5},end:{line:18,column:97}}}))+'\n\t\t\t\t</p>\n\t\t\t\t<button class="butt">\n\t\t\t\t\t'+c((p(l,"outlet")||n&&p(n,"outlet")||o).call(i,null!=n?p(n,"gift-pro-view"):n,{name:"outlet",hash:{},data:a,loc:{start:{line:21,column:5},end:{line:21,column:29}}}))+"\n\t\t\t\t</button>\n\t\t\t</div>\n"},3:function(t,n,l,e,a){var s,i=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'\t\t\t<div class="moola-container">\n'+(null!=(s=t.invokePartial(i(e,"prbd-moola-position"),n,{name:"prbd-moola-position",hash:{class:"download-interstitial-upsell",advertisingStitching:null!=n?i(n,"advertisingStitching"):n,upsellFallback:!1,adUnit:null!=(s=null!=n?i(n,"adConfig"):n)?i(s,"adUnit"):s},data:a,indent:"\t\t\t\t",helpers:l,partials:e,decorators:t.decorators}))?s:"")+"\t\t\t</div>\n"},5:function(t,n,l,e,a){var s,i=null!=n?n:t.nullContext||{},o=t.hooks.helperMissing,r=t.escapeExpression,c=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'\t\t\t<div class="buy-pro-container">\n\t\t\t\t<div class="flickr-pro-logo">\n\t\t\t\t\t<img class="logo" src="'+r("function"==typeof(s=null!=(s=c(l,"flickrProLogo")||(null!=n?c(n,"flickrProLogo"):n))?s:o)?s.call(i,{name:"flickrProLogo",hash:{},data:a,loc:{start:{line:33,column:28},end:{line:33,column:45}}}):s)+'">\n\t\t\t\t</div>\n\t\t\t\t<div class="ad-free">\n\t\t\t\t\t<p class="text">'+r((c(l,"intlHTMLMessage")||n&&c(n,"intlHTMLMessage")||o).call(i,{name:"intlHTMLMessage",hash:{intlName:"products-flickrpro.DOWNLOAD_MODAL_AD_FREE_BROWSING"},data:a,loc:{start:{line:36,column:21},end:{line:36,column:102}}}))+'</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="product-support">\n\t\t\t\t\t<p class="text">'+r((c(l,"intlHTMLMessage")||n&&c(n,"intlHTMLMessage")||o).call(i,{name:"intlHTMLMessage",hash:{intlName:"products-flickrpro.DOWNLOAD_MODAL_PREMIUM_SUPPORT"},data:a,loc:{start:{line:39,column:21},end:{line:39,column:101}}}))+'</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="instant-download">\n\t\t\t\t\t<p class="text">'+r((c(l,"intlHTMLMessage")||n&&c(n,"intlHTMLMessage")||o).call(i,{name:"intlHTMLMessage",hash:{intlName:"products-flickrpro.DOWNLOAD_MODAL_INSTANT_DL"},data:a,loc:{start:{line:42,column:21},end:{line:42,column:96}}}))+'</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="unlimited-backup">\n\t\t\t\t\t<p class="text">'+r((c(l,"intlHTMLMessage")||n&&c(n,"intlHTMLMessage")||o).call(i,{name:"intlHTMLMessage",hash:{intlName:"products-flickrpro.DOWNLOAD_MODAL_UNLIMITED_BACKUP"},data:a,loc:{start:{line:45,column:21},end:{line:45,column:102}}}))+'</p>\n\t\t\t\t</div>\n\t\t\t\t<button class="butt">\n\t\t\t\t\t'+r((c(l,"intlHTMLMessage")||n&&c(n,"intlHTMLMessage")||o).call(i,{name:"intlHTMLMessage",hash:{intlName:"common.GET_FLICKR_PRO"},data:a,loc:{start:{line:48,column:5},end:{line:48,column:57}}}))+"\n\t\t\t\t</button>\n\t\t\t</div>\n"},compiler:[8,">= 4.3.0"],main:function(t,n,l,e,a){var s,i=null!=n?n:t.nullContext||{},o=t.hooks.helperMissing,r=t.escapeExpression,c=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<div class="download-interstitial-container">\n\t<div class="interstitial-upsell-container">\n'+(null!=(s=(c(l,"ifCond")||n&&c(n,"ifCond")||o).call(i,null!=n?c(n,"version"):n,"===","giftPro",{name:"ifCond",hash:{},fn:t.program(1,a,0),inverse:t.noop,data:a,loc:{start:{line:3,column:2},end:{line:24,column:13}}}))?s:"")+(null!=(s=(c(l,"ifCond")||n&&c(n,"ifCond")||o).call(i,null!=n?c(n,"version"):n,"===","ad",{name:"ifCond",hash:{},fn:t.program(3,a,0),inverse:t.noop,data:a,loc:{start:{line:25,column:2},end:{line:29,column:13}}}))?s:"")+(null!=(s=(c(l,"ifCond")||n&&c(n,"ifCond")||o).call(i,null!=n?c(n,"version"):n,"===","buyPro",{name:"ifCond",hash:{},fn:t.program(5,a,0),inverse:t.noop,data:a,loc:{start:{line:30,column:2},end:{line:51,column:13}}}))?s:"")+'\t</div>\n\t<div class="interstitial-text-container">\n\t\t<div class="title-container">\n\t\t\t<div class="progress-container">\n\t\t\t\t<div class="progress-text-container">\n\t\t\t\t\t<p class="text">\n\t\t\t\t\t\t'+r((c(l,"intlMessage")||n&&c(n,"intlMessage")||o).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.DOWNLOAD_MODAL_PREPARING_HEADER"},data:a,loc:{start:{line:58,column:6},end:{line:58,column:83}}}))+'\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="circular-progress-graph">\n\t\t\t\t\t<svg class="icon icon-check"><use xlink:href="#icon-check">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="licensing-attribution-container">\n\t\t\t<p class="text">\n\t\t\t\t'+r((c(l,"intlHTMLMessage")||n&&c(n,"intlHTMLMessage")||o).call(i,{name:"intlHTMLMessage",hash:{learnMoreUrl:null!=n?c(n,"learnMoreUrl"):n,license:null!=n?c(n,"license"):n,username:null!=n?c(n,"displayName"):n,intlName:"photo-page-scrappy.DOWNLOAD_MODAL_USER_PHOTO_LICENSE"},data:a,loc:{start:{line:68,column:4},end:{line:68,column:150}}}))+'\n\t\t\t</p>\n\t\t\t<p class="text">\n\t\t\t\t'+r((c(l,"intlHTMLMessage")||n&&c(n,"intlHTMLMessage")||o).call(i,{name:"intlHTMLMessage",hash:{proURL:null!=n?c(n,"proURL"):n,intlName:"interstitials.ADVERTISEMENTS_HELP_KEEP_FLICKR_FREE_BUY_PRO"},data:a,loc:{start:{line:71,column:4},end:{line:71,column:107}}}))+"\n\t\t\t</p>\n\t\t</div>\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),e={};t.Array.each(["prbd-moola-position"],(function(n){var l=t.Template.get("hermes/"+n);l&&(e[n]=l)})),t.Template.register("hermes/photo-page-download-interstitial",(function(n,a){return(a=a||{}).partials=a.partials?t.merge(e,a.partials):e,l(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-prbd-moola-position"]});YUI.add("photo-page-download-interstitial-view",(function(e,t){var i=require("hermes-core/flog")(t),r=new e.SubscriptionsHelper;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.params=t,this.adTimerStartValue=e.config.flickr.moola.positions.interstitials[2].ad_timer_start_value,this.interstitialType="ad",this.photoId=t.photoId,this.ownerNsid=t.nsid,this.adUnit,this.adConfig,"ad"===this.interstitialType&&(this.adUnit=e.config.flickr.moola.positions.interstitials[2],this.adConfig={adUnit:this.adUnit.ad_unit_desktop}),this},subviewConfig:{"gift-pro-view":{placement:"photoPageDownloadInterstitial",requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){let t=this;return e.Promise.all([t.appContext.getModel("person-models",t.ownerNsid),t.appContext.getModel("photo-models",t.photoId)]).then((e=>(t.set("personModel",e[0]),t.set("photoModel",e[1]),t.appContext.getModel("license-models",e[1].getValue("license"))))).then((e=>{t.set("licenseModel",e)})).catch((e=>{i.error("Error with fetching models",{err:e})}))},buildContainer:function(){let t=this.get("personModel"),i=(this.get("photoModel"),this.get("licenseModel")),o=t.getValue("buddyicon").large?t.getValue("buddyicon").large:t.getValue("buddyicon").default,n=t.getValue("displayname"),a=t.getValue("nsid"),s=i.getValue("url"),l=i.getValue("intlDesc"),d=e.URLHelper.generatePersonUrls(t),h="ad"===this.interstitialType;return this.adEventStitch=h?this.appContext.adManager.getHashedAdValue(this.appContext.adManager.getAdPositioning(this.get("container"))):"",this.setContainerWithTemplate("photo-page-download-interstitial",{version:this.interstitialType,adConfig:h?this.adConfig:{},advertisingStitching:this.adEventStitch,displayName:n,pathAlias:d.profile,buddyIcon:o,nsid:a,license:l,learnMoreUrl:s,flickrProLogo:e.config.flickr.urls.assetRoot+"/images/pro/flickr-pro-h1-ic.png",proURL:r.getProLandingPageUrl(r.UTM_ADS_KEEP_FLICKR,{content:"download"})}),this},activate:function(){let e=this.get("container"),t=e.one(".buy-pro-container");return"ad"===this.interstitialType&&(this.appContext.adManager.processAdsOnPage(),this.appContext.adManager.signalAdRequest(this)),t&&t.one(".butt")&&this.registerEventHandler(t.one(".butt").on("click",this.handleFlickrProClick.bind(this))),this.graphContainer=e.one(".progress-container .circular-progress-graph"),this.progressGraph=this.drawProgressGraph(),this.adCountdown(this.adTimerStartValue),this.progressGraph.start(),this},handleFlickrProClick:function(){e.config.win.location=e.url("/account/upgrade/pro")},adCountdown:function(e){let t=this,i=e,r=this.get("container");this.adInterval=setInterval((function(){i>=1?i-=1:(clearInterval(t.adInterval),t.fire("subviewViewEvent","timerEnded"),r.one(".progress-text-container").one(".text")&&(r.one(".progress-text-container").one(".text").getDOMNode().innerText=t.intlMessage({intlName:"photo-page-scrappy.DOWNLOAD_MODAL_COMPLETE"})),r.one(".circular-progress-graph").one(".icon-check")&&r.one(".circular-progress-graph").one(".icon-check").setStyle("display","block"))}),1e3)},drawProgressGraph:function(){return new e.CircleFillGraph({containerElement:this.graphContainer.getDOMNode(),dim:{width:35,height:35},lineWidth:4,backgroundStrokeColor:"#e1e1e1",gradient:[{fillProportion:0,value:"128fdc"},{fillProportion:1,value:"128fdc"}],duration:this.adTimerStartValue,stops:[{durationProportion:1,fillProportion:1,easeFunction:"linear"}],segments:120,className:"progress-icon"})},destructor:function(){this.progressGraph.stop(),this.progressGraph=null}})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-download-interstitial","circle-fill-graph","url-helper","url"],optionalRequires:["hermes-core"],langBundles:["photo-page-scrappy","common","settings","products-flickrpro","interstitials"]});YUI.add("hermes-lang-interstitials_es-us",(function(a,e){a.Intl.add("hermes/interstitials","es-US",{ADVERTISEMENTS_HELP_KEEP_FLICKR_FREE:[{type:0,value:"Los anuncios permiten que Flickr sea gratis."}],CLICK_CONTINUE_TO_PHOTOSTREAM:[{type:0,value:'Haz clic en el botón "Continuar" para ir a tu stream de fotos.'}],CTA_CONTINUE_TO_PHOTOSTREAM:[{type:0,value:"Continuar al stream de fotos"}],CTA_PLAN_TO_CHECKOUT:[{type:0,value:"Activa Flickr Pro por "},{type:1,value:"amount"},{type:0,value:"/mes"}],CTA_PLAN_TO_CHECKOUT_WITH_DISCOUNT:[{type:0,value:'Obtén Flickr Pro por <br><span class="strike">'},{type:1,value:"regularCost"},{type:0,value:'</span> <span class="discounted-price">'},{type:1,value:"discountedCost"},{type:0,value:"/mes*</span>"}],WELCOME_PRO_OFFER_DESCRIPTION:[{type:0,value:"Tu cuenta gratuita está limitada a 1,000 cargas públicas de fotos y videos, que se muestran con anuncios."}],WELCOME_PRO_NO_DISCOUNT:[{type:0,value:"Actualiza a Flickr Pro para disfrutar de lo mejor de Flickr."}],WELCOME_PRO_WITH_DISCOUNT:[{type:0,value:'<div class="sub-cta"> ¡Los nuevos miembros de Flickr como tú reciben </div><div class="flickr-pro-discount">&nbsp;'},{type:1,value:"number_symbol"},{type:0,value:"% de descuento para un año de Flickr Pro! </div>"}],WELCOME_TO_FLICKR:[{type:0,value:"¡Bienvenido a Flickr!"}],CONTINUE_WITH_A_FREE_ACCOUNT:[{type:0,value:"Continúa con una cuenta gratis"}],CONTINUE_TO_FLICKR:[{type:0,value:"Continuar a Flickr"}],ADVERTISEMENTS_HELP_KEEP_FLICKR_FREE_BUY_PRO:[{type:0,value:'La publicidad ayuda a hacer que Flickr sea gratis. <a href="'},{type:1,value:"proURL"},{type:0,value:'" target="_new"> Sube de categoría a Flickr Pro para disfrutar de una experiencia sin anuncios </a>'}],NO_THANKS_CONTINUE:[{type:0,value:"No gracias. Continuar a Flickr."}],UNLIMITED_UPLOADS:[{type:0,value:"Cargas ilimitadas"}],AD_FREE_BROWSING:[{type:0,value:"Navegación sin anuncios"}],ADVANCED_STATS:[{type:0,value:"Estadísticas avanzadas de fotos"}],NO_ADS_JUST_PHOTOS:[{type:0,value:"Sin anuncios, solo fotos"}]})}),"@VERSION@",{requires:["intl"]});YUI.add("photo-engagement-view",(function(e,t){require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.params=t,t.showFaveCount=t.isResponsiveMobile,this.photoId=t.photoId,this.nsid=t.nsid,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.signinPendingQueue=t.signinPendingQueue,this.isResponsiveMobile=t.isResponsiveMobile,this.photoPrintsHelper=new e.PhotoPrintsHelper(this.appContext),this.signedIn=this.appContext.getViewer().signedIn,this.photoCardHelper=new e.PhotoCardHelper(this.appContext),this.curationHelper=new e.CurationHelper(this.appContext,{view:this}),this.downloadLink="",this.downloadInterstitialModal,t.subviewParams={"like-engagement-item-view":{photoId:t.photoId,showCount:!1,size:"medium",isPadded:!0}},this},subviewConfig:{"fave-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,hideWhoFaved:!0,additionalViewClasses:["engagement-item"],disabled:function(){return this.appContext.flipper.isFlipped("enable-likes")}},"like-engagement-item-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["engagement-item"],theme:"light",disabled:function(){return!this.appContext.flipper.isFlipped("enable-likes")}},"photo-well-scrappy-edit-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:function(){return this.appContext.flipper.isFlipped("enable-photo-page-lightbox-updates")?["engagement-item","enable-photo-page-lightbox-updates"]:["engagement-item"]}},"fluid-share-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["engagement-item"],theme:"light"},"print-button-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["engagement-item"]}},loadState:function(){let e=this.appContext.getViewer(),t=[];return t.push(this.appContext.getModel("photo-models",this.photoId).then((e=>{e.getValue("owner");return this.set("photo",e),this.downloadButtonEnabled=!1,e.getValue("isVideo")?(this.appContext.flipper.isFlipped("disable-video-playback")?this.downloadButtonEnabled=!1:this.downloadButtonEnabled=e.getValue("engagement").getValue("canDownload"),this.downloadLink="/video_download.gne?id="+e.getValue("id")):(this.downloadButtonEnabled=!0,this.downloadLink=e.getValue("url")+"/sizes/l/"),this.appContext.getModel("person-relationship-models",e.getValue("owner").getValue("nsid"))})).then((e=>{this.set("relationshipModel",e)}))),e.signedIn&&t.push(this.appContext.getModel("privileges-models",e.nsid).then((e=>{this.privs=e.getValue("privileges")}))),Promise.all(t)},buildContainer:function(){var e,t=this.get("photo"),o=t.getValue("owner"),n=this.get("container"),i=this.photoCardHelper.convertPhotoModel(t);return e={"share-view":this.subviews["fluid-share-photo-view"]?this.subviews["fluid-share-photo-view"].get("container"):"",photoId:t.getValue("id"),ownerId:t.getValue("owner").getValue("id"),isVideo:t.getValue("isVideo"),viewerIsOwner:o.getValue("isMe"),downloadingAvailable:this.downloadButtonEnabled,downloadLink:this.downloadLink,showPrintButton:this.photoPrintsHelper.canPrintPhoto(t,this.get("relationshipModel")),photoItem:i,signedIn:this.signedIn,faveCount:t.getValue("engagement").getValue("faveCount"),commentCount:t.getValue("engagement").getValue("commentCount"),isResponsiveMobile:this.isResponsiveMobile},this.appContext.forceServerRender&&(e.downloadItems=this.getDownloadMenuItems()),this.setContainerWithTemplate("photo-engagement",e),this.isResponsiveMobile&&n.addClass("responsive-mobile"),this},activate:function(){var t=this,o=(this.get("photo").getValue("license"),this.get("container"));if(this.engagementModel=this.get("photo").getValue("engagement"),this.signinPendingQueue&&this.signinPendingQueue.length>0)for(var n=this.signinPendingQueue,i=0;i<n.length;i++)"download"===n[i].key&&n[i].value&&n[i].value.id===this.photoId&&this.downloadItem(n[i].value.imageUrl);return this.engagementModel.getValue("canDownload")&&this.registerEventHandler(e.one("body").delegate("click",(function(e){t.canShowDownloadInterstitial()?t.showDownloadIntersitialModal(e):t.handleDownloadItemClick(e)}),".sizes li a.download-image-size")),this.attachKeyEvent("down:68",this.handleDownloadMenuButtonClick.bind(this)),this.registerEventHandler(o.delegate("click",this.handleDownloadMenuButtonClick.bind(this),".download a")),this.curateNode=o.one(".engagement-item.curate"),this.curateNode&&this.registerEventHandler(this.curateNode.on("click",this.handleCurateClick.bind(this))),this.commentNode=o.one(".engagement-item.comment"),this.commentNode&&(this.commentTextNode=this.commentNode.one(".engagement-count"),this.registerEventHandler(this.commentNode.on("click",this.showCommentsModal.bind(this)))),this.faveTextNode=o.one(".fave-count"),this.registerEventHandler(this.engagementModel.on("valuesChanged",this.handleEngagementModelValuesChanged.bind(this))),this},canShowDownloadInterstitial:function(){let e=this.appContext.viewportData.getWidth();return!this.get("photo").getValue("owner").getValue("isMe")&&(window&&window.innerWidth&&window.innerWidth!==e&&(e+=this.appContext.viewportData.scrollbarWidth),e&&e>700&&this.appContext.adManager.canShowAdWithPhoto(this.get("photo")))},showDownloadIntersitialModal:function(t){let o=this;t.preventDefault(),this.downloadInterstitialModal=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,showBodyLines:!1,showCancelButton:!1,showFooter:!1,showCancelX:!0,subview:new e.Views["photo-page-download-interstitial-view"]({appContext:o.appContext,nsid:this.nsid,photoId:this.photoId}),width:900,minWidth:650,height:540,fullWindow:!1,classList:"download-interstitial-modal"}),this.downloadInterstitialModal.show(),this.downloadInterstitialModal.on("timerEnded",(function(){o.handleDownloadItemClick(t)}))},getDownloadMenuItems:function(t){var o,n=this.get("photo"),i=e.clone(n.getValue("sizes")),s=[],a=n.getValue("engagement").getValue("canDownload"),l=this,d=n.getValue("upgradeSizes");for(const e in i)i[e].size=e;var h=n.getValue("owner").getValue("isMe")&&this.privs.hasDownloadRestrictions;let r;if(["q","sq"].some((function(e){if(i[e])return i[e].label=l.intlMessage({intlName:"photo-page-scrappy.SQUARE"}),s.push(i[e])})),["w","n","s","t"].some((function(e){if(i[e])return i[e].label=l.intlMessage({intlName:"photo-page-scrappy.SMALL"}),s.push(i[e])})),["c","z","m"].some((function(e){if(i[e])return i[e].label=l.intlMessage({intlName:"photo-page-scrappy.MEDIUM"}),s.push(i[e])})),["k","h","l"].some((function(e){if(i[e]&&!d.includes(e))return i[e].label=l.intlMessage({intlName:"photo-page-scrappy.LARGE"}),s.push(i[e])})),h){const e={h:"settings-privacy.LARGE_1600",k:"settings-privacy.LARGE_2048","3k":"settings-privacy.X_LARGE_3K","4k":"settings-privacy.X_LARGE_4K","5k":"settings-privacy.X_LARGE_5X","6k":"settings-privacy.X_LARGE_6X"};r={};const t=["k","h","l"].find((function(e){return d.includes(e)})),o=["6k","5k","4k","3k"].find((function(e){return d.includes(e)}));t&&(r[t]={label:l.intlMessage({intlName:e[t]})}),o&&(r[o]={label:l.intlMessage({intlName:e[o]})}),r.o={label:l.intlMessage({intlName:"photo-page-scrappy.ORIGINAL_SIZE"})}}else{["6k","5k","4k","3k"].some((function(e){if(i[e]&&!d.includes(e))return i[e].label=l.intlMessage({intlName:"common.XLARGE"}),s.push(i[e])}));let e="o";i[e]&&!d.includes(e)&&(i[e].label=l.intlMessage({intlName:"photo-page-scrappy.ORIGINAL"}),s.push(i[e]))}let p=new e.PhotoSizeHelper(this.appContext);for(o=0;o<s.length;o++)s[o].url=p.getDownloadUrl(s[o].size,s[o].displayUrl,"photoPageEngagement");return this.templates("scrappy-download-menu")({photoURL:n.getValue("url"),sizes:s,disabledSizes:r,showDownloadSizes:a})},createDownloadDialog:function(t){var o=this.get("container");this.downloadMenu&&(this.downloadMenu.close(),this.downloadMenu=null),this.downloadMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,preferTop:!0,showDropArrow:!0,anchorOffsetVertical:5,anchorElement:o.one(".download"),htmlMessage:t,closeOnScroll:!1,classList:"scrappy-download-droparound",autoSizeToContent:!0,contentPadding:0}),this.downloadMenu.show()},handleDownloadMenuButtonClick:function(e){let t=this.get("photo");if(t.getValue("isVideo")){e.preventDefault(),t.getValue("owner").getValue("isMe")&&this.privs.hasDownloadRestrictions?this.showVideoDownloadUpsell():this.downloadButtonEnabled&&this.downloadItem(this.downloadLink)}else this.downloadButtonEnabled&&(e.halt(),this.createDownloadDialog(this.getDownloadMenuItems()))},handleDownloadItemClick:function(t){t.preventDefault(),this.downloadItem(t.currentTarget.getAttribute("href"));let o=t.currentTarget;if(o){let t=o.getAttribute("data-size"),n=o.getAttribute("data-res-width"),i=o.getAttribute("data-res-height");t&&n&&i&&e.Snowplough.sendSelfDescribingEvent({schema:e.Snowplough.SCHEMAS.DOWNLOAD,data:{photoId:[parseInt(this.get("photo").getValue("id"),10)],size:t.toLowerCase(),width:parseInt(n,10),height:parseInt(i,10),license:parseInt(this.get("photo").getValue("license"),10),ownerNsid:this.get("photo").getValue("owner").id,isBatch:!1}},e.Snowplough.getPhotoContextFromModel(this.get("photo")))}!this.canShowDownloadInterstitial()&&this.downloadMenu&&(this.downloadMenu.close(),this.downloadMenu=null)},downloadItem:function(e){document.location=e},handleCurateClick:function(){var t=this,o=this.get("photo").getValue("isOwner");"fluid-droparound-view"===this.curationHelper.showAddToCuration({photoId:this.get("photo").getValue("id"),showAlbums:o,showGalleries:!o,anchorNode:this.curateNode,theme:this.params.theme}).name&&(this.fire("menuOpened"),this.curationHelper.on("curateDroparoundClosed",(function(){t.fire("menuClosed"),t.curateNode.removeClass("active")})),this.curateNode.addClass("active")),e.Snowplough.sendStructuredEvent({category:"photopageinteractions",action:"curateClick"},e.Snowplough.getPhotoContextFromModel(this.get("photo")))},showCommentsModal:function(){var t={appContext:this.appContext,photoId:this.photoId,isScrollable:!0,hasHeader:!0},o=new e.ModalDroparoundHelper(this.appContext,{useViewportType:!1,containerType:"modal",configs:{common:{subviewName:"photo-comments-view",subviewParams:t},modal:{height:550,flexLayout:!0}}});this.registerEventHandler(o.on("close",(()=>{e.fire("photoCommentModalClosed",{photoId:this.photoId})}))),this.registerEventHandler(e.on("addComment:showingSignupModal",(()=>{o.close()}))),o.show()},handleEngagementModelValuesChanged:function(t){var o,n;t.commentCount?(o=t.commentCount.newVal,this.commentTextNode&&(this.commentTextNode.set("text",e.IntlNumber.format(o,this.appContext.lang,1)),this.commentTextNode.toggleClass("hidden",0===o))):t.faveCount&&(n=t.faveCount.newVal,this.faveTextNode&&(this.faveTextNode.set("text",e.IntlNumber.format(n,this.appContext.lang,1)),this.faveTextNode.toggleClass("hidden",0===n)))},showVideoDownloadUpsell:function(){new e.Views.FluidDroparound({appContext:this.appContext,preferTop:!0,anchorElement:this.get("container").one(".download"),htmlMessage:this.templates("video-downloads-upsell")({upgradeUrl:"/account/upgrade/pro?utm_campaign=downloads&utm_source=photo_page&utm_medium=popover"}),closeOnScroll:!1,autoSizeToContent:!0}).show()}})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-engagement","hermes-template-scrappy-download-menu","hermes-template-video-downloads-upsell","signup-modal-view","fluid-share-photo-view","fluid-droparound-view","print-button-view","photo-comments-view","better-throttle","photo-prints-helper","photo-card-helper","fluid-modal-view","photo-page-download-interstitial-view","photo-size-helper"],optionalRequires:["hermes-core"],optional:["photo-models"],langBundles:["common","photo-page-scrappy","comments","settings-privacy"]});